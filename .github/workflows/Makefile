OBJS = build-and-test.yml

# Files containing code imported in other files
LIBS= lib.libsonnet

all: $(OBJS)

# Depending on $(LIBS) below is a bit coarse grained and manual; any modif
# will trigger the regeneration of all the jsonnet.
# alt: a 'make depend' first to extract those dependencies, but not worth it.
# Note that in pre-commit.jsonnet in jsonnet-gha we make sure the .yml
# are up-to-date with the latest content in the .jsonnet (and .libsonnet).
%.yml: %.jsonnet $(LIBS)
	echo "# AUTOGENERATED FROM $< DO NOT MODIFY" > $@
	../../scripts/jsonnet_to_yaml.sh $< >> $@ \
	  || { rm -f $@; exit 1; }

clean:
	rm -f $(OBJS)
